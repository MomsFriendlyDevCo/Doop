<p align="center">
	<img src="https://github.com/MomsFriendlyDevCo/Doop/raw/master/DOOP/assets/doop.png">
</p>
<br><br>

Doop!
=====
The MEAN micro-framework used by [MomsFriendlyDevCo](http://mfdc.biz).

**If we hit that bullseye, the rest of the dominoes will fall like a house of cards. Checkmate - Zapp Brannigan**


Basic principles:

* Doop tries to have the lowest understanding cost possible
* Doop units are designed to be as generic and transferable between projects as possible


References:

* [Doop back-end reference](BACKEND.md)
* [Doop front-end reference](FRONTEND.md)
* [Doop command-line interface](https://github.com/MomsFriendlyDevCo/doop-cli)


Terminology:

* The Doop documentation endeavour to use requirement levels that abide by the definitions specified by [RFC 2119 (Requirement Levels)](http://www.ietf.org/rfc/rfc2119.txt)


General concept
===============

Units
-----
A Doop Unit is a generic interchangeable collection of controllers, models, templates and other resources used by one system entity.

Front-end and back-end resources are stored both in their containing unit within `/units`. See [front-end](FRONTEND.md) or [back-end](BACKEND.md), respectively.


NPM modules
-----------
MFDC relies on various common NPM modules across all its projects.

You can read more about how MFDC structures its project in the [Momsronomicon](https://github.com/MomsFriendlyDevCo/Momsronomicon/blob/master/devstack-node.md).


Project layout
==============
The project tree breakdown is listed below. For each path an 'edit chance' is given (i.e. the possibility of the developer needing to change the contents of that directory) and a brief description.

| Path or Glob                          | Exposed as    | Description
| ------------------------------------- | ------------- |------------
| `/`                                   |               | The project root
| `/build/`                             |               | Generated files directory. Do not edit the contents of this directory as it is auto-generated by Gulp.
| `/config/index.conf.js`               |               | Base config file showing default variables subsequently overridden by each `NODE_ENV` config file
| `/config/private.conf.js`             |               | Private config details. This file is listed in `.gitignore` and should *never* be checked in to GitHub as it can contain private details - e.g. database connection passwords or API keys
| `/config/production.conf.js`          |               | Production server config details. This should include settings to enable all minimizers and other optimizations for production-ready code
| `/config/`                            |               | Storage for all config scripts read at startup, see `/server/config/index.conf.js` for default config setup. Other files are read depending on the `NODE_ENV` setting
| `/data/`                              |               | Generic data for the project - could contain resource files used during automated builds
| `/docs/`                              |               | Any miscellaneous files not relevant to the operation of the project but which need to be retained e.g. scope documents, ERD diagrams
| `/gulpfile.js`                        |               | Main Gulp build-system config file
| `/gulp/*.gulp.js`                     |               | Global Gulp build-system task files
| `/node_modules/`                      |               | Install directory for all NPM controlled packages
| `/server.js`                          |               | Back-end/application entry point
| `/tests/`                             |               | Optional testing files
| `/units/`                             |               | Directory of all back-end and front-end units
| `/units/core/backend.js`              |               | Back-end entry point (this class creates a stub `global.app` object suitable for use in Gulp / Mocha etc.
| `/units/core/frontend.js`             |               | Front-end entry point
| `/units/layouts/*.html`               |               | Main layout template files
| `/units/layouts/main.html`            |               | Default layout template file to use unless specified in server controller
| `/units/scenarios/defaults/`          |               | The default scenario file to use when no other is specified. The contents of this directory are processed when running `gulp db`
| `/units/scenarios/`                   |               | Sample population data for all models, created by [Mongoose-Scenario](https://github.com/hash-bang/Node-Mongoose-Scenario). Each sub-directory should correspond with a scenario build profile with `defaults` being the default
| `/units/theme/`                       |               | Front-end media and content assets related to the theme
| `/units/**/*.ctrl.js`                 | `fooCtrl` (lower case, singular, suffix with `ctrl`) | Front-end Angular controllers -- where the front-end business logic is resides. These generally map onto Angular components
| `/units/**/*.css`                     |                                                      | Front-end CSS files
| `/units/**/*.dirv.js`                 | `foo` (lower case, singular)                         | Front-end Angular directives -- these are reuseable HTML components / custom HTML elements
| `/units/**/*.fltr.js`                 | `foo` (lower case, singular)                         | Front-end Angular filters
| `/units/**/*.gulp.js`                 |                                                      | Back-end Gulp files included into the gulp setup by individual units
| `/units/**/*.hook.js`                 |                                                      | Back-end Hooks loaded during the service loading stage. See [Back-end hooks](#back-end-hooks)
| `/units/**/*.modl.js`                 | `Foo` (upper case first letter, singular)            | Angular resource models
| `/units/**/*.path.js`                 |                                                      | Back-end route paths (Express Controllers) loaded during the controller loading stage. See [Back-end hooks](#back-end-hooks)
| `/units/**/*.rout.js`                 |                                                      | Front-end route configuration
| `/units/**/*.schm.js`                 | `Foos` (upper case first letter, plural)             | Back-end MongoDB Schema Models loaded by the DB unit. See [Back-end hooks](#back-end-hooks)
| `/units/**/*.serv.js`                 | `$foo` (lower case all, prefix with `$`)             | Front-end services -- these are reuseable components for controllers
| `/units/**/*.test.js`                 |                                                      | Back-end additional tests to run per-unit
| `/units/**/*.tmpl.html`               |                                                      | Front-end HTML partials
| `/units/core/`                        |                                                      | Bootstrapper front-end and back-end files
| `/units/core.db/`                     |                                                      | The main database driver and schema loader
| `/units/layouts/`                     |                                                      | Layout files used to serve the basic HTML page structure
| `/units/middleware/`                  | `app.middleware.SOMETHING`                           | Middleware utility libraries
| `/units/pages/`                       |                                                      | Page inserts used by the backend fot form the basic HTML page structure (a page loads inside a layout skeleton)
| `/units/parsing/`                     |                                                      | Back-end parsing drivers. Includes components like cookie decoding
| `/units/router/`                      |                                                      | Front-end router
| `/units/theme/`                       |                                                      | Directory of default app CSS/Styling

**NOTES**

* Dotted notion in unit names generally means an extension to an existing unit. For example `units/companies` is the `Foo` unit but `units/companies.employees` signifies that the `employees` substructure is an extension of that unit. Generally extensions are used like this when the sub-unit structure becomes complex and needs to be separated.
* Directive (`*.dirv.js`) and controller (`*.ctrl.js`) front-end files are all Angular Components and are more or less interchangeable. The naming convention is separated to signify that a controller should be a singleton whereas a directive can be used multiple times in a widget like invocation within code.


Testing + Debugging
===================

Unit tests
----------
Larger projects can populate the `/tests/` directory with [Mocha](https://mochajs.org) + [Chai](http://chaijs.com/api/bdd) test cases. Tests can also be specified per-unit by adding any file matching the glob `*.test.js` within their unit directory.

To run a Unit test you will need to have Mocha installed (`sudo npm i -g mocha`). Either run mocha with no specified files to process *all* test files or specify the specific test file(s) you wish Mocha to examine as command line arguments.

Run the *all* the tests with mocha in the project root directory with `mocha`.

**TIP:** Unit tests can be skipped temporarily by either adding an 'x' before `describe` / `it` or adding `.skip` as a suffix. e.g. To temporarily skip a test rename the function `describe('something something')` to `xdescribe('something something')` or `describe.skip('something something')`.
**TIP::** As with the above you can also force Mocha to *only* run one test - this is useful if your test is deeply nested within an existing file and you don't want to add `skip` to each other case. To use this add `.only` as a suffix for the `describe` / `it` declaration. e.g. `it('should do this', function() { ... })` becomes `it.only('should do this', function() { ... })`.


Command line debugging
----------------------
Doop, like most modules, responds to the `DEBUG` flag used by the [Debug](https://github.com/visionmedia/debug) module. This turns on verbose logging when running within a console.
The `DEBUG` variable can be set to the specific module you would like to log, a number of them via comma-seperated-values or a glob expression. For example `DEBUG=doop gulp` runs Gulp and tells Doop to run in debug mode.

Some tips:
* For internal problems with Doop (such as issues with load order, hooks or other structural issues) set `DEBUG=doop` before running. e.g. `DEBUG=doop gulp` when running within Doop.
* For async related issues set [Async-Chainables debug flag](https://github.com/hash-bang/async-chainable#debugging). e.g. `DEBUG=async-chainable gulp`
* For database related issues set Monoxides debug flag. e.g. `DEBUG=monoxide`. This can be especially useful when debugging why Monoxide (the Doop ReST handler) didn't perform a certain action such as creating a record.


Site deployment checklist
=========================
This list is intended as a guide to help deploy a Doop site:

* Replace all `FIXME` markers - especially in `config/index.conf.js` and `package.json`
* Replace the contents of `units/theme/favicon` with your own Favicon. We recommend using [Real Favicon Generator](http://realfavicongenerator.net) to generate all the weird and wondeful varients that are required. Remember to also update the paths to the favicon in `units/layouts/main.html` if they change.
* Replace `units/theme/logo.png` with your own project logo
* Check the database connection works and set up a basic database with `gulp db`
* Edit the `units/config/config.serv.js` file and configure what data should be exposed to the front-end
